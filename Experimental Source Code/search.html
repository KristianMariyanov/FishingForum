<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <script src="jquery-2.1.1.min.js"></script>
        <script src="mustache.js"></script>
    </head>
    <body>
    <form id="form">
    	<input type="search" id="search">
    	<select id ="search-options">
    		<option value="question-by-tag">Question By Tag</option>
    		<option value="question-by-title">Question By Title</option>
    		<option value="question-by-text">Question By Text</option>
    		<option value="user">User</option>	
    	</select>
    	<input type="submit" value="search">
    </form>
    <div class='result'></div>
        <script>
        $(document).ready(function () {
        	$('#form').submit(function (event) {
        		event.preventDefault();
        		if ($('#search-options').val() === "question-by-tag") {
    				var tagTitle = $('#search').val();
    				search.questionByTag(tagTitle);
        		}
        		
        	})	
        })
        var questionTemplate = '<div class="questions"><p>{{title}}</p><span>{{author.username}}</span><span>{{createdAt}}</span><span>{{category.name}}</span><span>{{rating}}</span><span>{{viewCount}}</span></div>';
        var search = (function () {
        	$.ajaxSetup({
        		headers : {
        			"X-Parse-Application-Id" : "qMgTURpDZUZXbS8OyDfvICSCMS5YkkpuMn9vIlco",
        			"X-Parse-REST-API-Key" : "KOWQQ2S9fB5Hx7bNjiv4bskSQrSuZvSniHUpF4Bb"
        		}
        	});
        	var questionByTag = function (tagTitle) {
				getTagIdByTitle(tagTitle).done(function(data) {
        			var tagId = data.results[0].objectId;
        			var getQuestionsUrl = 'https://api.parse.com/1/classes/tagsMeta?include=question.category,question.author&where={"tag":{"__type":"Pointer","className":"tag","objectId":"' + tagId +'"}}'
        			getResults(getQuestionsUrl).done (function (data) {
        				console.log(data.results);
        				$.each(data.results, function (index, value) {
        					var question = Mustache.to_html(questionTemplate, value.question);
        					$(document.body).append(question);
        				})
        			}).fail (function (error) {
        				console.log(error)
        			});
        		}).fail(function (error) {
        			console.log(error)
        		});
        	}
        	var getTagIdByTitle = function (tagTitle) {
        		return getResults('https://api.parse.com/1/classes/tag?where={"title":"' +  tagTitle + '"}')
        		
        	}

        	var getResults = function (url) {
        		return $.getJSON(url)
        	}

    		return {
    			questionByTag : questionByTag
    		}
        })();
        </script>
    </body>
</html>